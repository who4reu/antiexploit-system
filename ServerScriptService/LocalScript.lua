-- Local Script (Put this inside AntiExploit.lua Server Scripts)
-- Turn the LocalScript Enabled variable to false

local Players = game:GetService("Players")
local Player = Players.LocalPlayer

local HttpService = game:GetService("HttpService")

local ReplicatedStorage= game:GetService("ReplicatedStorage")
local _Workspace_ = game:GetService("Workspace")
repeat wait() until game:IsLoaded()

local WhitelistedGuis = {"HDAdminGUIs", "ProximityPrompts" ,"ServerPanel" ,"AdminPanel","Chat", "Freecam", "KCoreUI", "ChatInstallVerifier", "LoadingGui", "TouchGui", "TopbarPlus", "BubbleChat", "RbxCameraUI", "ChatMessageHandler", "SetupQuickJoiners"}
local BannedItems = {"BodyGyro", "BodyPosition", "BodyForce", "BodyVelocity", "BodyAngularVelocity", "ModuleScript", "Folder", "Animation"}
local BannedHumanoidStates = {6, 11, 14, 16}

local Webhook = "" -- Current Webhook
local Embeddebounce = false

function SendlogToWebhook(Player, Text)
	-- Use a single timestamp for consistency:
	local timestamp = os.date("!%Y-%m-%d %H:%M:%S")

	local payload = {
		username = "security guards",
		embeds = {
			{
				title = "Exploit Log's",
				color = 16734296, -- Red color
				fields = {
					{
						name = "Action",
						value = "```"..Text.."```",
						inline = false
					},
                    --[[{
                        name = "Stack Trace",
                        value = messageType,
                        inline = false
                    },]]
					{
						name = "Username",
						value = Player.Name,
						inline = true
					},
					{
						name = "User ID",
						value = Player.UserId,
						inline = true
					},
					{
						name = "Account Age",
						value = Player.AccountAge,  -- Use the same timestamp here
						inline = true
					},
					{
						name = "Server",
						value = game.JobId,
						inline = true
					}
				},
				timestamp = timestamp  -- Use the same timestamp here
			}
		}
	}

	HttpService:PostAsync(Webhook, HttpService:JSONEncode(payload))
end

function Disconnect(Player, Message)
	pcall(function()
		ReplicatedStorage.RemoteEvents.ClientKick:FireServer(Message)
		SendlogToWebhook(Player, Message)
		Player:Kick(Message)
	end)
end

coroutine.resume(coroutine.create(function()
	while wait(10) do
		pcall(function()
			for _, Child in pairs(Player.PlayerGui:GetChildren()) do
				if table.find(WhitelistedGuis, Child.Name) then return end
				if Child:IsA("LocalScript") or Child.Name == "Dex" then
					Disconnect(Player, Player.Name.." was being getting caught for using another gui")
				end
			end
			
			if _Workspace_:GetRealPhysicsFPS() > 60 then
				Disconnect(Player, Player.Name.." is get caught for being not be grateful for the existing FPS")
			end
		end)
	end
end))

Player.Character:WaitForChild("Humanoid").StateChanged:Connect(function(PrevState, CurrentState)
	if table.find(BannedHumanoidStates, CurrentState.Value) then
		Disconnect(Player, Player.Name.." doesn't have the flying sim yet, bcz the humanoidstate was unexpectedly changed to "..CurrentState)
	end
end)

Player.Backpack.ChildAdded:Connect(function(Child)
	for _, v in pairs(Child:GetDescendants()) do
		if v.Name:lower():find("bt") then
			Disconnect(Player, Player.Name.." was using btool's")
		end
	end
end)

Player.PlayerGui.ChildAdded:Connect(function(Child)
	if not table.find(WhitelistedGuis, Child.Name) then
		Disconnect(Player, Player.Name.." just inserted gui that called "..Child.Name..", I've never heard that before")
	end
end)

Player.Character.DescendantAdded:Connect(function(Descendant)
	if table.find(BannedItems, Descendant.ClassName) then
		Disconnect(Player ,"a "..Descendant.ClassName.." was unexpectedly inserted into "..Player.Name.." character")
	end
end)
